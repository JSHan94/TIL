# 비대칭 암호화

데이터를 암호화하는 키와 복호화하는 키가 각기 다른 형태의 암호화

<p align="center">
  <img src="https://www.researchgate.net/profile/Jarrod-Trevathan/publication/277736892/figure/fig31/AS:669381424066579@1536604376826/Public-Private-Key-Encryption-and-Digital-Signatures.jpg"/>
</p>

수신자의 공개키로 암호화하여 개인키로 복호화하는 것이 **공개키 암호화** <br/>
발신자의 개인키로 암호화하여 발신자의 공개키로 검증하는 것이 **디지털 서명** <br/>

# 비대칭 알고리즘

- **정수 인수분해** : 큰 정수를 인수분해하기가 매우 어렵다는 사실에 근거. RSA가 해당 알고리즘에 속함
- **이산 로그 기법** : 모듈로 함수의 결과를 계산하는 일은 쉽지만, 생성원의 지수를 구하는 일은 계산적으로 실행 불가능함. 즉, 결과로부터 입력을 구하는 것이 어려움을 이용. 예를 들어  3<sup>2</sup> mod 10 = 9와 같이 방정식에 9가 주어졌을 때 생성원 3의 지수를 구하는 문제에서, 2를 결과로 구하는 것이 상당히 어려움. 이 어려운 문제는 일반적으로 Diffie-Hellman 키 교환 알고리즘과 디지털 서명에 사용됨
- **타원 곡선 알고리즘** : 이산 로그 문제를 기반으로 하지만 타원 곡선과 관련되어 있음. 타원 곡선은 체상의 삼차 대수 곡선이며, y<sup>2</sup> = x<sup>3</sup> + ax + b로 정의 될 수 있음. 타원 곡선은 non-singular한 특징 때문에 뾰족점이나 자기교차가 없음. 타원 곡선은 [무한원점](https://ko.wikipedia.org/wiki/%EB%AC%B4%ED%95%9C%EC%9B%90%EC%A0%90과 2개의 변수 a, b를 가짐. ECDSA (타원 곡선 디지털 서명 알고리즘)과 ECDH(타원 곡선 디피-헬만) 키 교환법이 해당 알고리즘에 속함

# 공개 키와 개인 키

- 개인 키 : 비밀리에 유지되는 무작위로 생성된 수이며, 사용자가 개인적으로 보유하는 키
- 공개 키 : 개인 키 소유자에 의해 발행 됨. 공개키로 암호화 된 메세지는 개인 키로 복호화가 가능함

## RSA

정수 인수분해 문제를 기반으로하여, 2개의 큰 소수의 곱셈은 쉽지만 인수분해는 어렵다는 특징을 이용. 키생성 과정은 다음과 같음<br/>

1. Modulus 생성
    - 매우 큰 소수 p,q를 선정하고 n = p x q인 modulus n을 생성함 
2. 서로소 생성
    - e 라는 수를 가정하고 다음과 같은 조건을 만족해야 함
    - e는 (p-1)(q-1)와 서로소이며 1 < e < (p-1)(q-1)여야 함 
3. 공개 키 생성
    - 1단계 에서 생성한 절대값과 2 단계에서 생성한 서로소 e가 함께 쌍을 이뤄 공개키가 되어 공개 가능
    - 대신 p와 q는 비밀로 유지되어야 함
4. 개인 키 생성
    - 개인 키를 d라고 할 때 p,q,e 로 계산 함
    - ed = 1 mod (p-1)(q-1)
    - 대부분의 경우 확장된 유클리드 알고리즘을 이용하여 d를 계산 함
    - 핵심 아이디어는 p,q를 아는 사람이라면 확장 유클리드로 개인 키 d를 쉽게 계산 가능하다는 것임
    - 그렇지만 p,q를 모르면 d를 생성할 수 없다는 것

RSA에서는 다음 방정식을 사용해 암호문을 생성함. 

<p align="center">C = P<sup>e</sup> mod n</p>

이 식은 평문 P를 e번 거듭제곱한 다음 mod n으로 감소시킨다는 것을 의미함 <br/>
복호화에는 다음과 같은 식이 사용됨

<p align="center">P = C<sup>d</sup> mod n</p>

즉 공개키 쌍 (n,e)를 가진 수신자는 C를 개인 키의 값만큼 거듭제곱 한 다음 mod n으로 감소시켜 복호화가 가능함


## 타원 곡선 암호화 (Elliptic Curve Cryptography, ECC)

타원곡선 암호화는 타원 곡선에 기초한 이산 로그 문제를 기반으로 함<br/>
ECC가 갖는 주요 이점은 RSA 같은 기법과 **동일한 보안 수준을 제공하면서 키의 크기가 더 작다는** 점<br/>
RSA에서 3072비트가 필요한 경우와 비교했을 때 ECC는 256비트의 피 연산자 만으로도 동일한 보안 수준 제공 가능<br/>
이런 이점 덕분에 ECC는 암호화에도 사용해도 되지만 대게 키 교환과 디지털 서명에 사용하는 것이 일반적임<br/>

### ECC를 이해하기 위한 수학

ECC는 기본적으로 Weierstrass equation이라고 알려진 다항 방정식의 한 유형으로, 유한체 위의 곡선을 생성함<br/>

<p align="center">y<sup>2</sup> = x<sup>3</sup> + Ax + B mod P</p>

A와 B는 유한체 Z<sub>p</sub> 혹은 유한소체 F<sub>p</sub>에 속하며, 무한원점이라는 특수한 값도 여기에 함께 속함<br/>
무한원점은 곡선의 점에 대한 항등 연산을 제공하는데 사용 되며, 위 식이 중복해를 갖지 않는 비특이적이어야 함<br/>
다음 방정식에 표현된 조건은 충족해야하는 기본 요구사항임<br/>

<p align="center">4a<sup>3</sup> + 27b<sup>2</sup> != 0 mod P</p>

### 점 덧셈 (Point addition)

타원 곡선상의 점 덧셈을 기하학 적으로 표현한 것 <br/>
P와 Q가 교차하며 곡선 사이에 세번째 점(R)이 생기는데 이 점을 반사 시키면 P+Q가 됨<br/>

<p align="center">
  <img src="https://miro.medium.com/max/708/1*nEPoRrtkwEkzbA_UMRp-wA.jpeg"/>
</p>

### 점 배가 (Point doubling)

P가 자신에게 더해지는 과정 <br/>
접선이 곡선을 통과하여 그려지며, 접선과 곡선의 교차점을 두번째 점을 반사 시켜 얻게 됨

<p align="center">
  <img src="https://www.researchgate.net/profile/Andrzej-Chmielowiec/publication/237135871/figure/fig2/AS:705058949844995@1545110561863/Elliptic-curve-point-doubling-over-R.png"/>
</p>

### ECC에서의 이산 로그 문제

ECC에서 이산 대수 문제는 특정 조건에서 타원 곡선상의 모든 점이 순환군을 형성한다는 아이디어에 근거함<br/>

- 공개 키(T) : 곡선상의 한 점. 생성원 점의 무작위 배수로 만들어짐
- 개인 키(d) : 배수를 생성하는데 사용되는 정수로 무작위로 선택됨

이산 로그 문제는 개인 키를 구하는데 사용되며, 이 정수는 타원 곡선상의 모든 점들 내에 속함<br/>
두 원소 P와 T를 가진 타원 곡선 E에서 정수 d를 구하는 문제임<br/>

<p align="center"> 1<= d <= #E</p>
<p align="center"> P + P + ... + P = dP = T</p>

ECC 곡선을 사용하기 위한 다양한 파라미터를 표준으로 권고하고 있는데, **secp256k1**의 명세가 하나의 예시며 비트코인에서는 이를 사용 중임
